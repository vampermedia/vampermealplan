<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Meal Planner</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Print Styles -->
    <style>
        @media print {
            body {
                background-color: white;
            }
            .print\:hidden {
                display: none !important;
            }
            main {
                padding: 0 !important;
                margin: 0 !important;
                width: 100% !important;
                display: block !important;
            }
            /* WYSIWYG Printing: Force background colors and remove default browser print styling overrides */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .shadow-lg, .rounded-xl {
                box-shadow: none !important;
                border-radius: 0 !important;
            }
            input {
                border: none !important;
                background: transparent !important;
            }
            @page {
                size: landscape;
                margin: 0.5cm;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons (Inline SVGs to avoid build steps) ---
        const Icons = {
            Utensils: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
            Printer: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Coffee: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
            Palette: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Edit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        };

        // --- Data & Constants ---
        const INITIAL_BREAKFAST_MEALS = [
            { id: 'b1', name: 'Ginisang Ampalaya + Beef Loaf', category: 'breakfast' },
            { id: 'b2', name: 'Tortang Talong + Ham/Bacon', category: 'breakfast' },
            { id: 'b3', name: 'Egg noodles + Omelette', category: 'breakfast' },
            { id: 'b4', name: 'Canned tuna + egg', category: 'breakfast' },
            { id: 'b5', name: 'Pork/Chicken Adobo (Baon)', category: 'breakfast' },
            { id: 'b6', name: 'Corned beef with potatoes', category: 'breakfast' },
            { id: 'b7', name: 'Pork bola-bola', category: 'breakfast' },
            { id: 'b8', name: 'Hotdogs + fried eggs', category: 'breakfast' },
            { id: 'b9', name: 'Fried chicken + mushroom soup', category: 'breakfast' },
        ];

        const INITIAL_MAIN_MEALS = [
            { id: 'm1', name: 'Chopsuey', category: 'main' },
            { id: 'm2', name: 'Afritada', category: 'main' },
            { id: 'm3', name: 'Pork BBQ + cucumber salad', category: 'main' },
            { id: 'm4', name: 'Pork Nilaga', category: 'main' },
            { id: 'm5', name: 'Pancit Canton Guisado', category: 'main' },
            { id: 'm6', name: 'Fish Paksiw', category: 'main' },
            { id: 'm7', name: 'Ginisang Monggo', category: 'main' },
            { id: 'm8', name: 'Pakbet', category: 'main' },
            { id: 'm9', name: 'Chicken Tinola', category: 'main' },
            { id: 'm10', name: 'Law-uy', category: 'main' },
            { id: 'm11', name: 'Igado / Liver Adobo', category: 'main' },
            { id: 'm12', name: 'Fish Tinola', category: 'main' },
            { id: 'm13', name: 'Garlic butter shrimp', category: 'main' },
            { id: 'm14', name: 'Humba', category: 'main' },
            { id: 'm15', name: 'Pork giniling w/ veggies', category: 'main' },
            { id: 'm16', name: 'Escabeche (fish)', category: 'main' },
            { id: 'm17', name: 'Ginisang upo', category: 'main' },
            { id: 'm18', name: 'Eggplant stir-fry w/ pork', category: 'main' },
        ];

        // Updated themes with Alternating Week colors
        const THEMES = {
            emerald: { 
                primary: 'bg-emerald-600', 
                secondary: 'bg-emerald-100', 
                border: 'border-emerald-200', 
                text: 'text-emerald-800', 
                hover: 'hover:bg-emerald-100',
                weekOdd: 'bg-emerald-50',
            },
            blue: { 
                primary: 'bg-blue-600', 
                secondary: 'bg-blue-100', 
                border: 'border-blue-200', 
                text: 'text-blue-800', 
                hover: 'hover:bg-blue-100',
                weekOdd: 'bg-blue-50',
            },
            rose: { 
                primary: 'bg-rose-600', 
                secondary: 'bg-rose-100', 
                border: 'border-rose-200', 
                text: 'text-rose-800', 
                hover: 'hover:bg-rose-100',
                weekOdd: 'bg-rose-50',
            },
            orange: { 
                primary: 'bg-orange-600', 
                secondary: 'bg-orange-100', 
                border: 'border-orange-200', 
                text: 'text-orange-800', 
                hover: 'hover:bg-orange-100',
                weekOdd: 'bg-orange-50',
            },
            slate: { 
                primary: 'bg-slate-700', 
                secondary: 'bg-slate-100', 
                border: 'border-slate-300', 
                text: 'text-slate-800', 
                hover: 'hover:bg-slate-100',
                weekOdd: 'bg-slate-50',
            },
        };

        // --- Main App Component ---
        function App() {
            const [mealCount, setMealCount] = useState(3);
            const [weekCount, setWeekCount] = useState(4); // New State for Weeks
            const [currentTheme, setCurrentTheme] = useState('emerald');
            const [assignments, setAssignments] = useState({});
            const [draggingMeal, setDraggingMeal] = useState(null);
            
            // New state for Calendar Title
            const [calendarTitle, setCalendarTitle] = useState('My Monthly Meal Plan');

            // Meal List State
            const [breakfastMeals, setBreakfastMeals] = useState(INITIAL_BREAKFAST_MEALS);
            const [mainMeals, setMainMeals] = useState(INITIAL_MAIN_MEALS);
            
            // New Meal Input State
            const [newMealName, setNewMealName] = useState('');
            const [newMealCategory, setNewMealCategory] = useState('main');

            // Bulk Add Confirmation State
            const [showBulkConfirm, setShowBulkConfirm] = useState(false);
            const [pendingMeals, setPendingMeals] = useState([]);

            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const theme = THEMES[currentTheme];

            // Helper: Count meal usage
            const getMealUsageCount = (mealId) => {
                return Object.values(assignments).filter(m => m.id === mealId).length;
            };

            // Helper: Sort meals alphabetically
            const sortedBreakfastMeals = useMemo(() => {
                return [...breakfastMeals].sort((a, b) => a.name.localeCompare(b.name));
            }, [breakfastMeals]);

            const sortedMainMeals = useMemo(() => {
                return [...mainMeals].sort((a, b) => a.name.localeCompare(b.name));
            }, [mainMeals]);

            // Drag and Drop Handlers
            const handleDragStart = (e, meal) => {
                setDraggingMeal(meal);
                e.dataTransfer.setData("meal", JSON.stringify(meal));
                e.dataTransfer.effectAllowed = "copy";
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = "copy";
            };

            const handleDrop = (e, dayIndex, slotIndex) => {
                e.preventDefault();
                const mealData = e.dataTransfer.getData("meal");
                
                if (mealData) {
                    const meal = JSON.parse(mealData);
                    const key = `${dayIndex}-${slotIndex}`;
                    setAssignments(prev => ({
                        ...prev,
                        [key]: meal
                    }));
                }
                setDraggingMeal(null);
            };

            const removeAssignment = (dayIndex, slotIndex) => {
                const key = `${dayIndex}-${slotIndex}`;
                const newAssignments = { ...assignments };
                delete newAssignments[key];
                setAssignments(newAssignments);
            };

            // Board Actions
            const clearBoard = () => {
                if (window.confirm("Are you sure you want to clear the entire calendar?")) {
                    setAssignments({});
                }
            };

            const printCalendar = () => {
                window.print();
            };

            // List Management Handlers
            const handleAddMeal = (e) => {
                e.preventDefault();
                if (!newMealName.trim()) return;

                // Split input by comma or new lines to support bulk add
                const rawMeals = newMealName.split(/[,\n]+/).map(s => s.trim()).filter(s => s.length > 0);

                if (rawMeals.length === 0) return;

                if (rawMeals.length === 1) {
                    // Single add
                    const newMeal = {
                        id: Date.now().toString(),
                        name: rawMeals[0],
                        category: newMealCategory
                    };
                    if (newMealCategory === 'breakfast') {
                        setBreakfastMeals(prev => [...prev, newMeal]);
                    } else {
                        setMainMeals(prev => [...prev, newMeal]);
                    }
                    setNewMealName('');
                } else {
                    // Bulk add detected - trigger confirmation
                    const preparedMeals = rawMeals.map((name, index) => ({
                        id: (Date.now() + index).toString(),
                        name,
                        category: newMealCategory
                    }));
                    setPendingMeals(preparedMeals);
                    setShowBulkConfirm(true);
                }
            };

            const confirmBulkAdd = () => {
                const category = pendingMeals[0]?.category || 'main';
                if (category === 'breakfast') {
                    setBreakfastMeals(prev => [...prev, ...pendingMeals]);
                } else {
                    setMainMeals(prev => [...prev, ...pendingMeals]);
                }
                setShowBulkConfirm(false);
                setPendingMeals([]);
                setNewMealName('');
            };

            const handleDeleteMeal = (id, category) => {
                if (window.confirm('Delete this meal from your list?')) {
                    if (category === 'breakfast') {
                        setBreakfastMeals(breakfastMeals.filter(m => m.id !== id));
                    } else {
                        setMainMeals(mainMeals.filter(m => m.id !== id));
                    }
                }
            };

            return (
                <div className={`min-h-screen bg-gray-50 font-sans text-gray-800 flex flex-col`}>
                    
                    {/* Bulk Add Confirmation Modal */}
                    {showBulkConfirm && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white p-6 rounded-lg shadow-xl max-w-md w-full">
                                <h3 className="font-bold text-lg mb-4 text-gray-800 flex items-center gap-2">
                                    <Icons.Plus className="w-5 h-5 text-emerald-600" />
                                    Confirm Multiple Meals
                                </h3>
                                <p className="mb-2 text-sm text-gray-600">We detected multiple items. Add these {pendingMeals.length} meals to your {pendingMeals[0]?.category === 'breakfast' ? 'Breakfast' : 'Main'} list?</p>
                                <ul className="list-disc pl-5 mb-6 max-h-48 overflow-y-auto bg-gray-50 p-2 rounded border border-gray-200 text-sm">
                                    {pendingMeals.map((m, i) => <li key={i} className="text-gray-700">{m.name}</li>)}
                                </ul>
                                <div className="flex justify-end gap-3">
                                    <button 
                                        onClick={() => { setShowBulkConfirm(false); setPendingMeals([]); }} 
                                        className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded text-sm font-medium transition-colors"
                                    >
                                        Cancel
                                    </button>
                                    <button 
                                        onClick={confirmBulkAdd} 
                                        className="px-4 py-2 bg-emerald-600 text-white hover:bg-emerald-700 rounded text-sm font-bold shadow transition-colors"
                                    >
                                        Add All
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Header - Hidden on Print */}
                    <header className={`print:hidden ${theme.primary} text-white shadow-md p-4 sticky top-0 z-10`}>
                        <div className="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-2">
                                <Icons.Utensils className="w-6 h-6" />
                                <h1 className="text-2xl font-bold tracking-tight">Monthly Meal Planner</h1>
                            </div>

                            <div className="flex flex-wrap items-center gap-4 justify-center">
                                {/* Theme Selector */}
                                <div className="flex items-center bg-white/20 rounded-full px-3 py-1 gap-2">
                                    <Icons.Palette className="w-4 h-4 text-white/80" />
                                    {Object.keys(THEMES).map((t) => (
                                        <button
                                            key={t}
                                            onClick={() => setCurrentTheme(t)}
                                            className={`w-5 h-5 rounded-full border-2 ${currentTheme === t ? 'border-white scale-110' : 'border-transparent opacity-70 hover:opacity-100'} transition-all`}
                                            style={{ backgroundColor: t === 'emerald' ? '#059669' : t === 'blue' ? '#2563eb' : t === 'rose' ? '#e11d48' : t === 'orange' ? '#ea580c' : '#334155' }}
                                            title={`Theme: ${t}`}
                                        />
                                    ))}
                                </div>

                                {/* Week Count Toggle */}
                                <div className="flex bg-white text-gray-800 rounded-lg overflow-hidden text-sm font-medium shadow-sm">
                                    {[4, 5].map(num => (
                                        <button
                                            key={num}
                                            onClick={() => setWeekCount(num)}
                                            className={`px-3 py-2 hover:bg-gray-100 transition-colors flex items-center gap-1 ${weekCount === num ? `${theme.text} bg-${theme.secondary.split('-')[1]}-200 font-bold` : ''}`}
                                            title={`${num} Weeks`}
                                        >
                                            <Icons.Calendar className="w-3 h-3" />
                                            {num} Wks
                                        </button>
                                    ))}
                                </div>

                                {/* Meal Count Toggle */}
                                <div className="flex bg-white text-gray-800 rounded-lg overflow-hidden text-sm font-medium shadow-sm">
                                    {[1, 2, 3].map(num => (
                                        <button
                                            key={num}
                                            onClick={() => setMealCount(num)}
                                            className={`px-4 py-2 hover:bg-gray-100 transition-colors ${mealCount === num ? `${theme.text} bg-${theme.secondary.split('-')[1]}-200 font-bold` : ''}`}
                                        >
                                            {num} Meal{num > 1 ? 's' : ''}
                                        </button>
                                    ))}
                                </div>

                                <button 
                                    onClick={printCalendar}
                                    className="flex items-center gap-2 bg-white text-gray-800 px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-gray-100 active:scale-95 transition-transform"
                                >
                                    <Icons.Printer className="w-4 h-4" /> Print
                                </button>
                                
                                <button 
                                    onClick={clearBoard}
                                    className="flex items-center justify-center bg-red-500 text-white w-10 h-10 rounded-lg shadow hover:bg-red-600 active:scale-95 transition-transform"
                                    title="Clear entire calendar"
                                >
                                    <Icons.Trash2 className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 container mx-auto p-4 flex flex-col lg:flex-row gap-6">
                        
                        {/* Sidebar: Meal List - Hidden on Print */}
                        <aside className="print:hidden w-full lg:w-96 flex-shrink-0 bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden h-[85vh] sticky top-24 flex flex-col">
                            <div className={`p-4 ${theme.secondary} border-b ${theme.border}`}>
                                <h2 className={`font-bold ${theme.text} flex items-center gap-2 mb-2`}>
                                    <Icons.Settings className="w-4 h-4" /> Meal Manager
                                </h2>
                                
                                {/* Add Meal Form */}
                                <form onSubmit={handleAddMeal} className="flex flex-col gap-2 bg-white p-2 rounded-lg shadow-sm">
                                    <textarea
                                        rows="2"
                                        placeholder="New meal name (separate multiple with commas)..."
                                        value={newMealName}
                                        onChange={(e) => setNewMealName(e.target.value)}
                                        className="w-full px-3 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none"
                                    ></textarea>
                                    <div className="flex gap-2">
                                        <select 
                                            value={newMealCategory} 
                                            onChange={(e) => setNewMealCategory(e.target.value)}
                                            className="flex-1 px-2 py-1.5 text-xs border border-gray-300 rounded focus:outline-none"
                                        >
                                            <option value="breakfast">Breakfast</option>
                                            <option value="main">Lunch/Dinner</option>
                                        </select>
                                        <button 
                                            type="submit"
                                            disabled={!newMealName.trim()}
                                            className={`px-3 py-1 text-white rounded text-sm font-medium flex items-center gap-1 ${!newMealName.trim() ? 'bg-gray-300' : theme.primary}`}
                                        >
                                            <Icons.Plus className="w-4 h-4" /> Add
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <div className="overflow-y-auto flex-1 p-4 space-y-6 scrollbar-thin scrollbar-thumb-gray-200">
                                <div>
                                    <h3 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                                        <Icons.Coffee className="w-4 h-4" /> Breakfast ({sortedBreakfastMeals.length})
                                    </h3>
                                    <div className="space-y-2">
                                        {sortedBreakfastMeals.length === 0 && <p className="text-xs text-gray-400 italic">No breakfast items.</p>}
                                        {sortedBreakfastMeals.map(meal => {
                                            const count = getMealUsageCount(meal.id);
                                            return (
                                                <div
                                                    key={meal.id}
                                                    draggable
                                                    onDragStart={(e) => handleDragStart(e, meal)}
                                                    className={`
                                                        p-3 border rounded-lg shadow-sm cursor-grab active:cursor-grabbing hover:shadow-md transition-all text-sm group relative flex justify-between items-center
                                                        ${count > 0 ? `bg-gray-50 ${theme.border} border-l-4` : 'bg-white border-gray-200 hover:border-yellow-400'}
                                                    `}
                                                >
                                                    <div className="flex items-center gap-2 pr-6">
                                                        <span className={`font-medium ${count > 0 ? 'text-gray-500' : 'text-gray-700'}`}>{meal.name}</span>
                                                        {count > 0 && (
                                                            <span className={`px-2 py-0.5 rounded-full text-xs font-bold text-white ${theme.primary}`}>
                                                                {count}
                                                            </span>
                                                        )}
                                                    </div>
                                                    
                                                    {count === 0 && <div className="w-1 h-full absolute left-0 top-0 bg-yellow-400 rounded-l-lg opacity-0 group-hover:opacity-100 transition-opacity"></div>}
                                                    
                                                    <button 
                                                        onClick={() => handleDeleteMeal(meal.id, 'breakfast')}
                                                        className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity absolute right-2"
                                                        title="Delete meal"
                                                    >
                                                        <Icons.X className="w-4 h-4" />
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                                        <Icons.Utensils className="w-4 h-4" /> Lunch & Dinner ({sortedMainMeals.length})
                                    </h3>
                                    <div className="space-y-2">
                                        {sortedMainMeals.length === 0 && <p className="text-xs text-gray-400 italic">No main items.</p>}
                                        {sortedMainMeals.map(meal => {
                                            const count = getMealUsageCount(meal.id);
                                            return (
                                                <div
                                                    key={meal.id}
                                                    draggable
                                                    onDragStart={(e) => handleDragStart(e, meal)}
                                                    className={`
                                                        p-3 border rounded-lg shadow-sm cursor-grab active:cursor-grabbing hover:shadow-md transition-all text-sm group relative flex justify-between items-center
                                                        ${count > 0 ? `bg-gray-50 ${theme.border} border-l-4` : 'bg-white border-gray-200 hover:border-orange-400'}
                                                    `}
                                                >
                                                    <div className="flex items-center gap-2 pr-6">
                                                        <span className={`font-medium ${count > 0 ? 'text-gray-500' : 'text-gray-700'}`}>{meal.name}</span>
                                                        {count > 0 && (
                                                            <span className={`px-2 py-0.5 rounded-full text-xs font-bold text-white ${theme.primary}`}>
                                                                {count}
                                                            </span>
                                                        )}
                                                    </div>

                                                    {count === 0 && <div className="w-1 h-full absolute left-0 top-0 bg-orange-400 rounded-l-lg opacity-0 group-hover:opacity-100 transition-opacity"></div>}

                                                    <button 
                                                        onClick={() => handleDeleteMeal(meal.id, 'main')}
                                                        className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity absolute right-2"
                                                        title="Delete meal"
                                                    >
                                                        <Icons.X className="w-4 h-4" />
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </aside>

                        {/* Main Calendar Area */}
                        <div className="w-fit mx-auto overflow-hidden bg-white rounded-xl shadow-lg border border-gray-400 flex flex-col print:shadow-none print:border-gray-400 print:overflow-visible">
                            
                            {/* Editable Calendar Title */}
                            <div className={`p-4 border-b border-gray-300 flex justify-center items-center ${theme.secondary} bg-opacity-30 relative group`}>
                                <div className="relative w-full max-w-lg flex items-center justify-center">
                                    <input 
                                        type="text" 
                                        value={calendarTitle}
                                        onChange={(e) => setCalendarTitle(e.target.value)}
                                        className={`text-2xl md:text-3xl font-bold text-center w-full bg-transparent focus:outline-none focus:border-b-2 focus:border-gray-400 ${theme.text}`}
                                        placeholder="Click to Edit Title (e.g., January 2024)"
                                    />
                                    <Icons.Edit className="w-5 h-5 opacity-40 absolute right-0 top-1/2 -translate-y-1/2 pointer-events-none group-hover:opacity-100 transition-opacity text-gray-500 print:hidden" />
                                </div>
                            </div>

                            {/* Calendar Header */}
                            <div style={{ display: 'grid', gridTemplateColumns: '0.75in repeat(7, 1.4in)' }} className="bg-gray-50 border-b border-gray-400">
                                <div className="p-2 md:p-3"></div> {/* Empty corner for Row Titles */}
                                {daysOfWeek.map((day, i) => (
                                    <div key={day} className={`p-2 md:p-3 text-center font-bold text-xs md:text-sm uppercase tracking-wider ${theme.text}`}>
                                        <span className="hidden md:inline">{day}</span>
                                        <span className="md:hidden">{day.slice(0,3)}</span>
                                    </div>
                                ))}
                            </div>

                            {/* Calendar Grid (Week Rows) */}
                            <div className="flex flex-col bg-gray-400 gap-px border-b border-gray-400 w-fit">
                                {Array.from({ length: weekCount }).map((_, weekIndex) => {
                                    const isAlternateWeek = weekIndex % 2 === 1;
                                    const weekBgColor = isAlternateWeek ? theme.weekOdd : 'bg-white';
                                    
                                    return (
                                        <div key={weekIndex} style={{ display: 'grid', gridTemplateColumns: '0.75in repeat(7, 1.4in)' }} className={`${weekBgColor} gap-px bg-gray-400`}>
                                            
                                            {/* Row Title Column (Leftmost) */}
                                            <div className={`${weekBgColor} flex flex-col h-full`}>
                                                {Array.from({ length: mealCount }).map((_, slotIndex) => {
                                                    // Determine label text
                                                    let label = '';
                                                    if (mealCount === 1) label = 'Meal';
                                                    else if (mealCount === 2) label = slotIndex === 0 ? 'Brunch' : 'Dinner';
                                                    else label = slotIndex === 0 ? 'Breakfast' : slotIndex === 1 ? 'Lunch' : 'Dinner';

                                                    return (
                                                        <div key={slotIndex} className="flex-1 border-b border-gray-100 last:border-0 flex items-center justify-center p-1">
                                                            <span className="text-[10px] font-bold text-gray-500 uppercase tracking-wide text-center leading-tight">{label}</span>
                                                        </div>
                                                    );
                                                })}
                                            </div>

                                            {/* Day Columns */}
                                            {Array.from({ length: 7 }).map((_, dayOffset) => {
                                                const dayIndex = weekIndex * 7 + dayOffset;
                                                
                                                return (
                                                    <div key={dayIndex} className={`${weekBgColor} min-h-[150px] flex flex-col relative group`}>
                                                        
                                                        {/* Meal Slots */}
                                                        <div className="flex-1 flex flex-col h-full">
                                                            {Array.from({ length: mealCount }).map((_, slotIndex) => {
                                                                const assignmentKey = `${dayIndex}-${slotIndex}`;
                                                                const assignedMeal = assignments[assignmentKey];
                                                                
                                                                return (
                                                                    <div
                                                                        key={slotIndex}
                                                                        onDragOver={handleDragOver}
                                                                        onDrop={(e) => handleDrop(e, dayIndex, slotIndex)}
                                                                        className={`
                                                                            flex-1 p-1 border-b border-gray-100 last:border-0 transition-colors relative flex items-center justify-center text-center
                                                                            ${!assignedMeal ? theme.hover : ''}
                                                                            bg-transparent
                                                                        `}
                                                                    >
                                                                        {assignedMeal && (
                                                                            <div className="h-full w-full flex items-center justify-center group/item pl-1 pr-1 relative">
                                                                                <span className="text-xs md:text-sm font-medium leading-tight text-gray-800 py-1">
                                                                                    {assignedMeal.name}
                                                                                </span>
                                                                                <button 
                                                                                    onClick={() => removeAssignment(dayIndex, slotIndex)}
                                                                                    className="absolute right-0 top-0 opacity-0 group-hover/item:opacity-100 text-gray-400 hover:text-red-500 p-1 print:hidden"
                                                                                >
                                                                                    <Icons.Trash2 className="w-3 h-3" />
                                                                                </button>
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
